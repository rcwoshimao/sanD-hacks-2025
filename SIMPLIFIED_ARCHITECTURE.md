# Moltbook News Service - Simplified Architecture (Updated)

Simplified 2-TIER architecture with direct sentiment analysis in workers

## New Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                         USER REQUEST                        │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
            ┌───────────────────────────────┐
            │          SUPERVISOR           │
            │   (Port 8003)                 │
            │   - FastAPI Server            │
            │   - LangGraph Orchestration   │
            └───────────────┬───────────────┘
                            │ A2A via NATS
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│  COMMUNITY    │   │  COMMUNITY    │   │  COMMUNITY    │
│  WORKER 1     │   │  WORKER 2     │   │  WORKER 3     │
│  (Port 9002)  │   │               │   │               │
│  - Scrapes    │   │  - Scrapes    │   │  - Scrapes    │
│    top 10     │   │    top 10     │   │    top 10     │
│    posts      │   │    posts      │   │    posts      │
│  - Analyzes   │   │  - Analyzes   │   │  - Analyzes   │
│    sentiment  │   │    sentiment  │   │    sentiment  │
│  - Generates  │   │  - Generates  │   │  - Generates  │
│    summary    │   │    summary    │   │    summary    │
└───────────────┘   └───────────────┘   └───────────────┘
```

## Workflow

### 1. User Request
```bash
POST /agent/prompt
{
  "community_urls": ["https://www.moltbook.com/m/technology"]
}
```

### 2. Supervisor → Worker (A2A)
- Supervisor assigns community URL to worker
- Sends via NATS: "Scrape and summarize: https://..."

### 3. Worker Processing
**Step 1:** Scrape top 10 posts (by engagement, past 24 hours)
- Mock data includes: title, content, upvotes, comments_count, sentiment

**Step 2:** Analyze posts with LLM
- Identify key themes and trends
- Assess overall sentiment
- Note emerging discussions

**Step 3:** Generate 1-2 paragraph summary
- Concise overview of community activity
- Highlights top trending post
- Captures general sentiment

### 4. Worker → Supervisor (A2A)
- Worker returns formatted summary
- Includes post count and top post info

### 5. Supervisor → User (HTTP)
- Aggregates all worker summaries
- Returns final report

## Example Output

```markdown
# Moltbook Community Summary: https://www.moltbook.com/m/technology

**Time Period:** Past 24 hours

## Community Activity Summary

The AI agent community is buzzing with discussions around framework adoption 
and protocol standardization. The launch of the Agentcy framework has sparked  significant interest, with developers praising its multi-agent capabilities. 
However, concerns about security vulnerabilities in A2A communication protocols are emerging as a key theme, with the security post garnering the highest engagement (203 upvotes). Overall sentiment is cautiously optimistic, with strong technical discussions around scaling challenges and transport layer choices (NATS vs SLIM).

---
*Report generated by Moltbook AI Agent News Service*
```

## Key Features

### Worker Agent Capabilities
1. **Scrapes top 10 posts** from Moltbook community
2. **Filters by time** (past 24 hours)
3. **Sorts by engagement** (upvotes + comments)
4. **Analyzes with LLM** to generate summary
5. **Returns concise report** (1-2 paragraphs)

### Mock Data Fields
Each post includes:
- `id`: Unique post identifier
- `title`: Post title
- `content`: Post content preview
- `upvotes`: Engagement metric
- `comments_count`: Number of comments
- `timestamp`: When posted (ISO format)
- `sentiment`: Pre-classified sentiment (for mock data)

### LLM Analysis Prompt
The worker sends posts to LLM with instructions to:
- Identify main themes and trending topics
- Assess overall sentiment and tone
- Highlight notable developments or concerns
- Capture emerging debates or consensus
- Keep summary concise (4-6 sentences)

## Components

### Files
```
agents/
├── supervisors/news
│   ├── main.py              # Supervisor FastAPI server
│   └── graph/
│       ├── shared.py        # Factory management
│       ├── tools.py         # A2A tools (supervisor → worker)
│       └── graph.py         # LangGraph orchestration
└── news/scraper/
      ├── card.py          # Agent card
      ├── agent.py         # Worker logic (scraping + analysis)
      ├── agent_executor.py # A2A executor
      └── server.py        # A2A server
```

### Docker Services
```
docker-compose.yaml:
  - nats (message broker)
  - news-scraper
  - news-supervisor
```

## Usage
### To Be Written

## Manual Test
### To Be Written

## Benefits

1. **Simpler architecture**: 2-tier instead of 3-tier
2. **Faster processing**: No A2A overhead for sub-agents
3. **Easier to understand**: Linear workflow
4. **Less infrastructure**: Fewer containers to manage
5. **Same scalability**: Can still run 10+ workers

## Next Steps

To implement real scraping, update `agents/news/scraper/agent.py`:

1. **Replace `scrape_moltbook_tool()`** with real web scraping
2. **Add time filtering** (past 24 hours)
4. **Return top 10 posts**

The rest of the system (supervisor, A2A, analysis) is ready to go!